<?xml version="1.0"?>

<!--

	ADOBE SYSTEMS INCORPORATED
	Copyright 2007 Adobe Systems Incorporated
	All Rights Reserved.

	NOTICE: Adobe permits you to use, modify, and distribute this file
	in accordance with the terms of the license agreement accompanying it.

-->

<project name="graphics" default="main" basedir=".">

	<property name="FLEX_HOME" location="${basedir}/../../.."/>

	<property file="${FLEX_HOME}/build.properties"/>

    <!-- If you change this, update <target-player/> in the <compc/> tasks. -->
    <property name="local.playerglobal.version" value="9"/>

	<target name="main" depends="clean,compile,doc" description="Clean build of FlexComponentBase.swc"/>

	<target name="clean">
		<delete failonerror="false">
			<fileset file="${basedir}/bundles.properties"/>
			<fileset dir="${basedir}/libs">
				<include name="FlexComponentBase.swc"/>
				<include name="FlexComponentBase.swc.incr"/>
			</fileset>
		</delete>
	</target>

	<target name="compile" description="Compiles FlexComponentBase.swc">
		<echo message="Compiling frameworks/projects/flash-integration/libs/FlexComponentBase.swc"/>
		<!-- Load the <compc> task. We can't do this at the <project> level -->
		<!-- because targets that run before flexTasks.jar gets built would fail. -->
		<taskdef resource="flexTasks.tasks" classpath="${FLEX_HOME}/lib/flexTasks.jar"/>
		<!--
			Link in the classes (and their dependencies) for the MXML tags
			listed in manifest.xml.
			Compile against framework source, and link it into FlexComponentBase.swc
			(only a few interfaces will be linked in).
			Don't put any resources into the SWC.
			Write a bundle list of referenced resource bundles
			into the file bundles.properties in this directory.
			(This should be an empty list.)
		-->
		<compc fork="true"
			   output="${basedir}/libs/FlexComponentBase.swc"
			   resource-bundle-list="${basedir}/bundles.properties">
            <!-- If you change this, update ${local.playerglobal.version} above. -->
            <target-player>9</target-player>
			<jvmarg line="${compc.jvm.args}"/>
			<namespace uri="http://www.adobe.com/2006/mxml" manifest="${basedir}/manifest.xml"/>
			<include-namespaces uri="http://www.adobe.com/2006/mxml"/>
			<source-path path-element="${basedir}/src"/>
			<source-path path-element="${FLEX_HOME}/frameworks/projects/framework/src"/>
			<library-path/>
            <external-library-path dir="${FLEX_HOME}/frameworks/libs">
                <include name="player/${local.playerglobal.version}/playerglobal.swc"/>
			</external-library-path>
			<locale/>
			<accessible>true</accessible>
			<compute-digest>false</compute-digest>
		</compc>
	</target>

    <condition property="asdocexe" value="asdoc.exe">
        <os family="windows"/>
    </condition>

    <condition property="asdocexe" value="asdoc">
        <os family="unix"/>
    </condition>

    <condition property="asdocexe" value="asdoc">
        <os family="mac"/>
    </condition>

	<target name="doc" depends="clean-temp-docs" description="updates FlexComponentBase.swc with asdoc xml">
		<!-- Call asdoc to generate dita xml files -->
		<exec executable="${FLEX_HOME}/bin/${asdocexe}" failonerror="true">
			<arg line="-doc-namespaces http://www.adobe.com/2006/mxml -namespace http://www.adobe.com/2006/mxml ${basedir}/manifest.xml -sp ${basedir}/src -sp ${FLEX_HOME}/frameworks/projects/framework/src -library-path= -external-library-path ${FLEX_HOME}/frameworks/libs/player/10/playerglobal.swc -keep-xml=true -skip-xsl=true -output ${FLEX_HOME}/tempDoc"/>
		</exec>

		<!-- updates FlexComponentBase.swc with asdoc xml -->
		<zip destfile="${basedir}/libs/FlexComponentBase.swc" update="true">
		    <zipfileset dir="${FLEX_HOME}/tempDoc/tempdita" prefix="docs">
			    <include name="*.*"/>
				<exclude name="ASDoc_Config.xml"/>
				<exclude name="overviews.xml"/>
		    </zipfileset>
		</zip>
	</target>

	<target name="clean-temp-docs">
		<delete dir="${FLEX_HOME}/tempDoc" failonerror="false" includeEmptyDirs="true"/>
	</target>

</project>
